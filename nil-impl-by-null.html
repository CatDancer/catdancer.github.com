<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html
><head
><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"
><title
>Speculative patch implementing Arc's nil with MzScheme's null</title
><style type="text/css"
>


body {
  font-family: verdana;
  margin-left: 2em;
}

p, ol, ul {
  width: 40em;
}

li {
  margin-bottom: 0.5em;
}

pre, code {
  font-family: courier;
}

td {
  vertical-align: top;
  padding: 0 1em 0.5em 0;
}

table.code {
  border-collapse: collapse;
}

table.code td {
  padding: 5px 1em;
  font-family: courier, monospace;
  border: 1px solid #ddd;
}

table.code td.arrow {
  border: none;
  padding: 0 1em;
  font-family: verdana;
}

table.code td.spacer {
  border: none;
  padding: 0;
}


</style
></head
><body
><a href="/"
>Cat’s hacks</a
>:<h1
>nil-impl-by-null</h1
><p
><i
>Speculative patch implementing Arc's nil with MzScheme's null</i
></p
><p
>This rough patch to arc2 tries out implementing Arc’s <code>nil</code> internally with MzScheme’s <code>null</code> <code>'()</code>, instead of using MzScheme's <code>nil</code> symbol.</p
><p
>From inside of Arc nothing has changed: lists are still terminated by <code>nil</code>, <code>nil</code> is still a symbol, <code>nil</code> still reads and prints as <code>nil</code>, and so on.  Only the internal representation of <code>nil</code> has changed.</p
><p
>This simplifies the Arc compiler since it doesn’t have to convert back and forth between <code>nil</code> and <code>'()</code> all the time.</p
><h2
>Bugs</h2
><ul
><li
>I took a weed-wacker to ac.scm and blindly removed all the ac-denil’s and ac-niltree’s.  I did no analysis of the code I was changing, so I expect I probably messed some things up. The extent of my testing was to run the patched Arc on one of my web pages and see that it didn’t crash.  But hey, it ran 7% faster.</li
><li
>I see one mistake already: I took out the check for setting nil when I should have changed it to check for setting '().</li
><li
>This patch depends on the list-writer patch to print <code>nil</code> as <code>nil</code>, and so shares that patch’s bug that writing lists containing cycles will go into an infinite loop, consume all your memory, and crash MzScheme.</li
></ul
>Have fixes?  Send them to me on <a href="http://github.com/CatDancer/arc/tree">GitHub</a>.<h2
>Contains</h2
><p
>This patch is built upon the following patches:</p
><ul
><li
><a href="list-writer.html"
>list-writer</a
> <i
>A writer for Arc lists.</i
></li
></ul
><h2
>Get This Hack</h2
><ul
><li
><a href="http://catdancer.github.com/arc2.nil-impl-by-null0.patch.txt" target="_blank"
>diff against arc2</a
></li
><li
><a href="http://github.com/CatDancer/arc/tree/arc2.nil-impl-by-null0"
>repository on GitHub</a
></li
><li
><a href="http://github.com/CatDancer/arc/tarball/arc2.nil-impl-by-null0"
>download a tarball of arc2 with this patch applied</a
></li
></ul
><h2
>Apply This Hack to Your Arc</h2
><p
>By using patch or git, you can incorporate this patch into your version of Arc.</p
><h3
>With patch</h3
><p
>To apply this patch to your copy of arc using the patch command, download <a href="http://catdancer.github.com/arc2.nil-impl-by-null0.patch"
>arc2.nil-impl-by-null0.patch</a
> into your Arc directory, and at the Unix command line inside the Arc directory, type:</p
><blockquote
><pre
> patch &#60;arc2.nil-impl-by-null0.patch</pre
></blockquote
><p
>&ldquo;<code>patch</code>&rdquo; is a standard utility that comes with Unix.  (If you&rsquo;re running Windows, iirc <code>patch</code> comes with cygwin).</p
><p
>For example,</p
><blockquote
><pre
> $ wget http://ycombinator.com/arc/arc2.tar
 [... downloading ...]
 $ tar xf arc2.tar
 $ cd arc2
 $ patch &#60;arc2.nil-impl-by-null0.patch
 patching [...]
 $</pre
></blockquote
><h3
>With git</h3
><p
>In a git repository that has the same arc2 ancestor commit as mine, git-merge can be used:</p
><blockquote
><pre
>$ git merge arc2.nil-impl-by-null0</pre
></blockquote
><p
>In a repository where arc2 has been checked in as a different commit, running git-merge will produce merge conflicts as it tries to apply both of the arc2 commits.  See the instructions at the end of <a href="sharing-hacks.html"
>Sharing Hacks</a
> for how to resolve the conflict.</p
><h2
>License</h2
><p
>The original Arc source is copyrighted by Paul Graham and Robert Morris and licensed under the Perl Foundations's Artistic License 2.0 as described in the “copyright” file in the Arc distribution.</p
><p
>My <i>changes</i> to Arc (this patch that I wrote) are in the <a href="http://creativecommons.org/licenses/publicdomain/"
>public domain</a
>.</p
><p
>The <i>combination</i> of the original Arc and my changes together (what you get after you apply my patch) is also licensed under the Perl Foundations's Artistic License 2.0.</p
></body
></html
>
