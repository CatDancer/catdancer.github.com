<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html
><head
><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"
><title
>Load an Arc source code file with renames</title
><style type="text/css"
>


body {
  font-family: verdana;
  margin-left: 2em;
}

p, ol, ul {
  width: 40em;
}

li {
  margin-bottom: 0.5em;
}

pre, code {
  font-family: courier;
}

td {
  vertical-align: top;
  padding: 0 1em 0.5em 0;
}

table.code {
  border-collapse: collapse;
}

table.code td {
  padding: 5px 1em;
  font-family: courier, monospace;
  border: 1px solid #ddd;
}

table.code td.arrow {
  border: none;
  padding: 0 1em;
  font-family: verdana;
}

table.code td.spacer {
  border: none;
  padding: 0;
}


</style
></head
><body
><a href="/"
>Cat’s hacks</a
>:<h1
>load-w/rename</h1
><p
><i
>Load an Arc source code file with renames</i
></p
><p
>thaddeus wanted to use my JSON library, but it defined a function called “alt” which conflicted with another library he was using that had a function with the same name.</p
><p
>Conventionally, libraries are supposed to carefully hide away their internals to avoid just this kind of conflict.  There’s a couple of problems with this approach though:</p
><ul
><li
>The library author doesn’t <i>know</i> how the library is going to be used, so the effort made to avoid conflicts is speculative: time may be spent hiding a function which as it turns out never would have caused a conflict in the future, or if the function <i>hadn’t</i> been hidden away it might have turned out to be useful to other code in ways that the library author hadn’t thought of.</li
><li
>Even after going to the extra work and attendent code complication of hiding library internals, the library may <i>still</i> be making names visible which conflict with some future use of the library.</li
></ul
><p
>Thus the problem with the conventional approach is that the library author is being asked to take responsibility for avoiding conflicts at the time the library is written, when it is impossible to know what actually needs to be done to avoid conflicts because the actual conflicts can’t be known until the library is used with other software.</p
><p
>Whether or not the library author has attempted to avoid conflicts by hiding library internals, if a conflict does occur then it falls upon the programmer using the library to resolve the conflict.</p
><p
>One approach to resolve the conflict is to simply rename the offending function or macro in the library, giving it a name that doesn't conflict with the other code being used.</p
><p
>Naturally if there’s some renaming that needs to be done, we’d prefer to let the computer do it for us rather than tediously having to go through the library source code doing the renaming by hand.</p
><blockquote
><pre
>
 (load-w/rename &#34;json.arc&#34; '((alt json-alt)))
</pre
></blockquote
><h2
>Get This Hack</h2
><ul
><li
><a href="http://catdancer.github.com/arc2.load-rename0.patch.txt" target="_blank"
>diff against arc2</a
></li
><li
><a href="http://github.com/CatDancer/arc/tree/arc2.load-rename0"
>repository on GitHub</a
></li
><li
><a href="http://github.com/CatDancer/arc/tarball/arc2.load-rename0"
>download a tarball of arc2 with this patch applied</a
></li
></ul
><h2
>Apply This Hack to Your Arc</h2
><p
>By using git or patch, you can incorporate this patch into your version of Arc.</p
><h3
>With git</h3
><blockquote
><pre
> $ git pull git://github.com/CatDancer/arc.git tag arc2.load-rename0</pre
></blockquote
><p
>For example,</p
><blockquote
><pre
> $ mkdir arc
 $ cd arc
 $ git init
 $ git pull git://github.com/CatDancer/arc.git tag arc2.load-rename0</pre
></blockquote
><h3
>With patch</h3
><p
>To apply this patch to your copy of arc using the patch command, download <a href="http://catdancer.github.com/arc2.load-rename0.patch"
>arc2.load-rename0.patch</a
> into your Arc directory, and at the Unix command line inside the Arc directory, type:</p
><blockquote
><pre
> patch &#60;arc2.load-rename0.patch</pre
></blockquote
><p
>&ldquo;<code>patch</code>&rdquo; is a standard utility that comes with Unix.  (If you&rsquo;re running Windows, iirc <code>patch</code> comes with cygwin).</p
><p
>For example,</p
><blockquote
><pre
> $ wget http://ycombinator.com/arc/arc2.tar
 [... downloading ...]
 $ tar xf arc2.tar
 $ cd arc2
 $ patch &#60;arc2.load-rename0.patch
 patching [...]
 $</pre
></blockquote
><h2
>Comment</h2
><a href="http://arclanguage.org/item?id=9202"
>Comment</a
> in the Arc Forum.<h2
>License</h2
><p
>The original Arc source is copyrighted by Paul Graham and Robert Morris and licensed under the Perl Foundations's Artistic License 2.0 as described in the “copyright” file in the Arc distribution.</p
><p
>My <i>changes</i> to Arc (this patch that I wrote) are in the <a href="http://creativecommons.org/licenses/publicdomain/"
>public domain</a
>.</p
><p
>The <i>combination</i> of the original Arc and my changes together (what you get after you apply my patch) is also licensed under the Perl Foundations's Artistic License 2.0.</p
></body
></html
>
